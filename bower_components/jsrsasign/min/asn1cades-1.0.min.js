/*! asn1cades-1.0.2.js (c) 2014-2017 Kenji Urushima | kjur.github.com/jsrsasign/license
 */
if(typeof KJUR=="undefined"||!KJUR){KJUR={}}if(typeof KJUR.asn1=="undefined"||!KJUR.asn1){KJUR.asn1={}}if(typeof KJUR.asn1.cades=="undefined"||!KJUR.asn1.cades){KJUR.asn1.cades={}}KJUR.asn1.cades.SignaturePolicyIdentifier=function(e){KJUR.asn1.cades.SignaturePolicyIdentifier.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.15";var b=KJUR.asn1;var d=KJUR.asn1.cades;if(typeof e!="undefined"){if(typeof e.oid=="string"&&typeof e.hash=="object"){var f=new b.DERObjectIdentifier({oid:e.oid});var a=new d.OtherHashAlgAndValue(e.hash);var c=new b.DERSequence({array:[f,a]});this.valueList=[c]}}};YAHOO.lang.extend(KJUR.asn1.cades.SignaturePolicyIdentifier,KJUR.asn1.cms.Attribute);KJUR.asn1.cades.OtherHashAlgAndValue=function(b){KJUR.asn1.cades.OtherHashAlgAndValue.superclass.constructor.call(this);var a=KJUR.asn1;var c=KJUR.asn1.x509;this.dAlg=null;this.dHash=null;this.getEncodedHex=function(){var d=new a.DERSequence({array:[this.dAlg,this.dHash]});this.hTLV=d.getEncodedHex();return this.hTLV};if(typeof b!="undefined"){if(typeof b.alg=="string"&&typeof b.hash=="string"){this.dAlg=new c.AlgorithmIdentifier({name:b.alg});this.dHash=new a.DEROctetString({hex:b.hash})}}};YAHOO.lang.extend(KJUR.asn1.cades.OtherHashAlgAndValue,KJUR.asn1.ASN1Object);KJUR.asn1.cades.SignatureTimeStamp=function(c){KJUR.asn1.cades.SignatureTimeStamp.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.14";this.tstHex=null;var a=KJUR.asn1;if(typeof c!="undefined"){if(typeof c.res!="undefined"){if(typeof c.res=="string"&&c.res.match(/^[0-9A-Fa-f]+$/)){}else{if(c.res instanceof KJUR.asn1.ASN1Object){}else{throw"res param shall be ASN1Object or hex string"}}}if(typeof c.tst!="undefined"){if(typeof c.tst=="string"&&c.tst.match(/^[0-9A-Fa-f]+$/)){var b=new a.ASN1Object();this.tstHex=c.tst;b.hTLV=this.tstHex;b.getEncodedHex();this.valueList=[b]}else{if(c.tst instanceof KJUR.asn1.ASN1Object){}else{throw"tst param shall be ASN1Object or hex string"}}}}};YAHOO.lang.extend(KJUR.asn1.cades.SignatureTimeStamp,KJUR.asn1.cms.Attribute);KJUR.asn1.cades.CompleteCertificateRefs=function(c){KJUR.asn1.cades.CompleteCertificateRefs.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.21";var a=KJUR.asn1;var b=KJUR.asn1.cades;this.setByArray=function(d){this.valueList=[];for(var e=0;e<d.length;e++){var f=new b.OtherCertID(d[e]);this.valueList.push(f)}};if(typeof c!="undefined"){if(typeof c=="object"&&typeof c.length=="number"){this.setByArray(c)}}};YAHOO.lang.extend(KJUR.asn1.cades.CompleteCertificateRefs,KJUR.asn1.cms.Attribute);KJUR.asn1.cades.OtherCertID=function(d){KJUR.asn1.cades.OtherCertID.superclass.constructor.call(this);var a=KJUR.asn1;var c=KJUR.asn1.cms;var b=KJUR.asn1.cades;this.hasIssuerSerial=true;this.dOtherCertHash=null;this.dIssuerSerial=null;this.setByCertPEM=function(e){this.dOtherCertHash=new b.OtherHash(e);if(this.hasIssuerSerial){this.dIssuerSerial=new c.IssuerAndSerialNumber(e)}};this.getEncodedHex=function(){if(this.hTLV!=null){return this.hTLV}if(this.dOtherCertHash==null){throw"otherCertHash not set"}var e=[this.dOtherCertHash];if(this.dIssuerSerial!=null){e.push(this.dIssuerSerial)}var f=new a.DERSequence({array:e});this.hTLV=f.getEncodedHex();return this.hTLV};if(typeof d!="undefined"){if(typeof d=="string"&&d.indexOf("-----BEGIN ")!=-1){this.setByCertPEM(d)}if(typeof d=="object"){if(d.hasis===false){this.hasIssuerSerial=false}if(typeof d.cert=="string"){this.setByCertPEM(d.cert)}}}};YAHOO.lang.extend(KJUR.asn1.cades.OtherCertID,KJUR.asn1.ASN1Object);KJUR.asn1.cades.OtherHash=function(c){KJUR.asn1.cades.OtherHash.superclass.constructor.call(this);var a=KJUR.asn1;var b=KJUR.asn1.cades;this.alg="sha256";this.dOtherHash=null;this.setByCertPEM=function(d){if(d.indexOf("-----BEGIN ")==-1){throw"certPEM not to seem PEM format"}var e=ASN1HEX.pemToHex(d);var f=KJUR.crypto.Util.hashHex(e,this.alg);this.dOtherHash=new b.OtherHashAlgAndValue({alg:this.alg,hash:f})};this.getEncodedHex=function(){if(this.dOtherHash==null){throw"OtherHash not set"}return this.dOtherHash.getEncodedHex()};if(typeof c!="undefined"){if(typeof c=="string"){if(c.indexOf("-----BEGIN ")!=-1){this.setByCertPEM(c)}else{if(c.match(/^[0-9A-Fa-f]+$/)){this.dOtherHash=new a.DEROctetString({hex:c})}else{throw"unsupported string value for params"}}}else{if(typeof c=="object"){if(typeof c.cert=="string"){if(typeof c.alg=="string"){this.alg=c.alg}this.setByCertPEM(c.cert)}else{this.dOtherHash=new b.OtherHashAlgAndValue(c)}}}}};YAHOO.lang.extend(KJUR.asn1.cades.OtherHash,KJUR.asn1.ASN1Object);KJUR.asn1.cades.CAdESUtil=new function(){};KJUR.asn1.cades.CAdESUtil.addSigTS=function(c,b,a){};KJUR.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(g){var n=ASN1HEX;var t=n.getChildIdx;var d=n.getTLV;var b=n.getTLVbyList;var j=n.getIdxbyList;var c=KJUR.asn1;var a=KJUR.asn1.cms;var l=KJUR.asn1.cades.CAdESUtil;var k={};if(b(g,0,[0])!="06092a864886f70d010702"){throw"hex is not CMS SignedData"}var w=j(g,0,[1,0]);var x=t(g,w);if(x.length<4){throw"num of SignedData elem shall be 4 at least"}var f=x.shift();k.version=d(g,f);var u=x.shift();k.algs=d(g,u);var e=x.shift();k.encapcontent=d(g,e);k.certs=null;k.revs=null;k.si=[];var o=x.shift();if(g.substr(o,2)=="a0"){k.certs=d(g,o);o=x.shift()}if(g.substr(o,2)=="a1"){k.revs=d(g,o);o=x.shift()}var s=o;if(g.substr(s,2)!="31"){throw"Can't find signerInfos"}var h=t(g,s);for(var p=0;p<h.length;p++){var q=h[p];var m=l.parseSignerInfoForAddingUnsigned(g,q,p);k.si[p]=m}var v=null;k.obj=new a.SignedData();v=new c.ASN1Object();v.hTLV=k.version;k.obj.dCMSVersion=v;v=new c.ASN1Object();v.hTLV=k.algs;k.obj.dDigestAlgs=v;v=new c.ASN1Object();v.hTLV=k.encapcontent;k.obj.dEncapContentInfo=v;v=new c.ASN1Object();v.hTLV=k.certs;k.obj.dCerts=v;k.obj.signerInfoList=[];for(var p=0;p<k.si.length;p++){k.obj.signerInfoList.push(k.si[p].obj)}return k};KJUR.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(i,o,e){var n=ASN1HEX;var p=n.getChildIdx;var c=n.getTLV;var k=n.getV;var b=KJUR.asn1;var a=KJUR.asn1.cms;var m={};var q=p(i,o);if(q.length!=6){throw"not supported items for SignerInfo (!=6)"}var f=q.shift();m.version=c(i,f);var g=q.shift();m.si=c(i,g);var l=q.shift();m.digalg=c(i,l);var h=q.shift();m.sattrs=c(i,h);var j=q.shift();m.sigalg=c(i,j);var d=q.shift();m.sig=c(i,d);m.sigval=k(i,d);var s=null;m.obj=new a.SignerInfo();s=new b.ASN1Object();s.hTLV=m.version;m.obj.dCMSVersion=s;s=new b.ASN1Object();s.hTLV=m.si;m.obj.dSignerIdentifier=s;s=new b.ASN1Object();s.hTLV=m.digalg;m.obj.dDigestAlgorithm=s;s=new b.ASN1Object();s.hTLV=m.sattrs;m.obj.dSignedAttrs=s;s=new b.ASN1Object();s.hTLV=m.sigalg;m.obj.dSigAlg=s;s=new b.ASN1Object();s.hTLV=m.sig;m.obj.dSig=s;m.obj.dUnsignedAttrs=new a.AttributeList();return m};